webpackJsonp([26],{633:function(t,e,a){"use strict";function n(t){if(!t)return 0;var e=t.match(/[^\x00-\xff]/g);return t.length+(e?e.length:0)}t.exports=function(t,e){var a=e||140,r=t.replace(/(^\s*)|(\s*$)/g,"");r=r.replace(/(\n+)/g,"\n");for(var s=t.match(/http(s*):\/\/[a-zA-Z0-9]+(\.[a-zA-Z0-9]+)+([-A-Z0-9a-z_$.+!*()\/,:;@&=?~#%]*)*/gi)||[],o=0,i=0,c=s.length;i<c;i++){var u=n(s[i]);/^(http:\/\/t\.cn)/.test(s[i])||(/^(http(s*):\/\/)+(t\.sina\.com\.cn|t\.sina\.cn)/.test(s[i])||/^(http(s*):\/\/)+(weibo\.com|weibo\.cn)/.test(s[i])?o+=u<=41?u:u<=a?20:u-a+20:o+=u<=a?20:u-a+20,r=r.replace(s[i],""))}return Math.ceil((o+n(r))/2)}},937:function(t,e,a){function n(t){a(938)}var r=a(3),s=a(940),o=a(941),i=n,c=r(s,o,!1,i,"data-v-153de370",null);t.exports=c.exports},938:function(t,e,a){var n=a(939);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);a(238)("14846737",n,!0)},939:function(t,e,a){e=t.exports=a(237)(!1),e.push([t.i,".m-pop[data-v-153de370]{position:fixed;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}.fadeInDown-enter-active[data-v-153de370],.fadeInDown-leave-active[data-v-153de370]{-webkit-transition:all .3s;transition:all .3s}.fadeInDown-enter[data-v-153de370],.fadeInDown-leave-active[data-v-153de370]{opacity:0}.fadeInDown-enter[data-v-153de370]{-webkit-transform:translate(-50%,-60%);transform:translate(-50%,-60%)}.fadeInDown-leave-active[data-v-153de370]{-webkit-transform:translate(-50%,-40%);transform:translate(-50%,-40%)}.gp-list[data-v-153de370]{-webkit-transition:all .5s;transition:all .5s}",""])},940:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=a(28),s=n(r),o=a(13),i=n(o),c=a(76),u=n(c),l=a(46),d=a(8),f=n(d),p=a(633),v=n(p),m=[];e.default={name:"FriendShips",data:function(){return{groups:[]}},methods:(0,u.default)({wordsCount:v.default,createGroup:function(){var t=this;if(this.groups.length>=20)return void f.default.$emit("mvToast",{type:"error",text:"最多建立<br>20个分组"});f.default.$emit("mvMsgbox",{title:"新建分组",type:"prompt",inputPlaceholder:"1-16个字符",validate:this.validate},function(e){e&&t.$http.post("friendships/groupscreate",{name:e}).then(function(e){if(e.data&&e.data.ok>0){var a=e.data.data,n={name:a.name,gid:a.gid||a.idstr,checked:!0};t.groups.push(n),f.default.$emit("mvMsgbox",!1)}else f.default.$emit("mvToast",{type:"error",text:"新建分组失败"})})})},validate:function(t){var e=(0,v.default)(t);return e<=8&&e>0},openGroupLists:function(){var t=this;this.$http.get("friendships/groups",{params:this.friendGroup}).then(function(e){var a=e.data;if(a&&a.ok>0){var n=a.data;n.lists&&n.lists.length>0&&(m=n.lists.map(function(t){var e=(0,i.default)({},t);return e.checked=n.listed.lists.some(function(t){return t.idstr===e.gid}),e}),t.groups=m.map(function(t){return(0,i.default)({},t)}))}})},closeGroupLists:function(){this.setFriendGroup()},groupsMemberBatch:function(){var t=this,e=this.groups.filter(function(t,e){return!m[e]||t.checked!==m[e].checked}).map(function(e){var a=e.checked?"groupsMemberAdd":"groupsMemberDestory";return t.$http.post("friendships/"+a,(0,i.default)({gid:e.gid},t.friendGroup))});s.default.all(e).then(function(e){e.some(function(t){return!(t.data&&t.data.ok>0)})&&f.default.$emit("mvToast",{type:"error",text:"设置分组失败"}),t.closeGroupLists()})},setRemark:function(){var t=this;f.default.$emit("mvMsgbox",{title:"设置备注",type:"prompt",inputPlaceholder:"1-16个字符",validate:this.validate,inputValue:this.userInfo.remark},function(e){f.default.$emit("mvMsgbox",!1),t.$http.post("friendships/remarkUpdate",(0,i.default)({remark:e},t.friendGroup)).then(function(a){a.data&&a.data.ok>0?t.setUserInfo((0,i.default)({},t.userInfo,{remark:e})):f.default.$emit("mvToast",{type:"error",text:"设置备注失败"})})})}},(0,l.mapActions)(["setFriendGroup","setUserInfo"])),computed:(0,l.mapGetters)(["friendGroup","userInfo"]),watch:{friendGroup:function(t){t&&this.openGroupLists()}}}},941:function(t,e){var a=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[t.friendGroup?a("div",{staticClass:"m-mask",on:{touchstart:function(t){t.stopPropagation(),t.preventDefault()},touchmove:function(t){t.stopPropagation(),t.preventDefault()}}}):t._e(),t._v(" "),a("transition",{attrs:{name:"fadeInDown"}},[t.friendGroup?a("div",{staticClass:"m-pop m-pop-lt"},[a("header",[t._v("选择分组")]),t._v(" "),a("section",[a("ul",[a("li",{on:{click:t.setRemark}},[a("a",{attrs:{href:"javascript:;",ontouchstart:""}},[t._v("设置备注")])])]),t._v(" "),a("ul",{staticClass:"gp-list"},[t._l(t.groups,function(e){return a("li",[a("label",{staticClass:"m-checkbox",attrs:{ontouchstart:""}},[t._v("\n              "+t._s(e.name)+"\n              "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.checked,expression:"group.checked"}],attrs:{type:"checkbox","true-value":!0,"false-value":!1},domProps:{checked:Array.isArray(e.checked)?t._i(e.checked,null)>-1:e.checked},on:{change:function(a){var n=e.checked,r=a.target,s=!!r.checked;if(Array.isArray(n)){var o=t._i(n,null);r.checked?o<0&&(e.checked=n.concat([null])):o>-1&&(e.checked=n.slice(0,o).concat(n.slice(o+1)))}else t.$set(e,"checked",s)}}}),t._v(" "),a("span",[a("i",{staticClass:"m-font m-font-check"})])])])}),t._v(" "),a("li",{on:{click:t.createGroup}},[a("a",{attrs:{ontouchstart:""}},[a("i",{staticClass:"m-font m-font-plus"}),t._v("新建分组")])])],2)]),t._v(" "),a("footer",{staticClass:"m-btm-btns m-box"},[a("div",{staticClass:"m-box-col"},[a("mv-btn",{nativeOn:{click:function(e){t.closeGroupLists(e)}}},[t._v("取消")])],1),t._v(" "),a("div",{staticClass:"m-box-col"},[a("mv-btn",{attrs:{color:"orange"},nativeOn:{click:function(e){t.groupsMemberBatch(e)}}},[t._v("确定")])],1)])]):t._e()])],1)},n=[];t.exports={render:a,staticRenderFns:n}}});